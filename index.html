<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cmdFreeCOM</title>
    <style>
        :root {
            --bg-dark: #121212;
            --text-dark: #00ff00;
            --bg-light: #f0f0f0;
            --text-light: #333;
            --accent: #00aa00;
            --error: #ff5555;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: var(--bg-dark);
            color: var(--text-dark);
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }
        
        body.light-mode {
            background: var(--bg-light);
            color: var(--text-light);
        }
        
        #header {
            margin-bottom: 30px;
        }
        
        #command-input {
            width: 70%;
            padding: 12px;
            background: inherit;
            color: inherit;
            border: 2px solid var(--accent);
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        #run-button {
            padding: 12px 24px;
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: opacity 0.2s;
        }
        
        #run-button:hover {
            opacity: 0.8;
        }
        
        #output {
            margin-top: 30px;
            white-space: pre-wrap;
            font-size: 18px;
            min-height: 200px;
            border: 1px dashed var(--accent);
            padding: 20px;
            text-align: left;
            overflow-wrap: break-word;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 10px;
            color: #00ffaa;
        }
        
        .error {
            color: var(--error);
        }
        
        .qr-code {
            max-width: 150px;
            height: auto;
            display: block;
            margin: 10px auto;
        }
    </style>
</head>
<body>
    <div id="header">
        <div class="logo">cmdFreeCOM</div>
        <p>Введи команду и получи магию!</p>
    </div>

    <div>
        <input 
            type="text" 
            id="command-input" 
            placeholder="Попробуй: help, calc, anime..."
            autofocus
            aria-label="Командная строка"
        >
        <button id="run-button" onclick="runCommand()">Выполнить</button>
    </div>

    <div id="output" aria-live="polite">
        Добро пожаловать! Начни с команды "help".
    </div>

    <script>
        // Состояние приложения
        const state = {
            secretNumber: null,
            calculatorMode: false,
            riddleAnswer: null,
            todoList: JSON.parse(localStorage.getItem('todo')) || [],
            theme: localStorage.getItem('theme') || 'dark',
            gameState: null,
            timers: {}
        };

        // Инициализация
        function init() {
            loadLastCommand();
            applyTheme();
            setupEventListeners();
        }

        // Загрузка последней команды
        function loadLastCommand() {
            const lastCommand = localStorage.getItem("lastCommand");
            if (lastCommand) {
                document.getElementById("output").innerHTML = 
                    `<pre>Последняя команда: <strong>${escapeHtml(lastCommand)}</strong></pre>`;
            }
        }

        // Применение темы
        function applyTheme() {
            document.body.classList.toggle('light-mode', state.theme === 'light');
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            const input = document.getElementById("command-input");
            input.addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    runCommand();
                }
            });
        }

        // Экранирование HTML
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Основная функция обработки команд
        async function runCommand() {
            const input = document.getElementById("command-input");
            const command = input.value.trim();
            const output = document.getElementById("output");

            // Очистка ввода
            input.value = "";
            
            try {
                const result = await processCommand(command.toLowerCase());
                output.innerHTML = `<pre>${result}</pre>`;
                
                // Сохраняем команду (кроме clear)
                if (command && !command.startsWith("clear")) {
                    localStorage.setItem("lastCommand", command);
                }
            } catch (error) {
                output.innerHTML = `<pre class="error">Ошибка: ${error.message}</pre>`;
            }
        }

        // Обработка команд
        async function processCommand(command) {
            if (!command) return "Введите команду";
            
            // Режим калькулятора
            if (state.calculatorMode) {
                state.calculatorMode = false;
                try {
                    return `= ${eval(command)}`;
                } catch {
                    throw new Error("Некорректное выражение");
                }
            }
            
            // Обработка команд
            switch (command.split(" ")[0]) {
                case "calc":
                    state.calculatorMode = true;
                    return "Режим калькулятора. Введите выражение:";
                    
                case "help":
                    return getHelpText();
                    
                case "clear":
                    localStorage.removeItem("lastCommand");
                    return "";
                    
                case "theme":
                    return handleThemeCommand(command);
                    
                case "todo":
                    return handleTodoCommand();
                    
                case "add":
                    return handleAddTodo(command);
                    
                case "del":
                    return handleDeleteTodo(command);
                    
                case "quiz":
                    return startQuiz();
                    
                case "answer":
                    return checkQuizAnswer(command);
                    
                case "game":
                    return startNumberGame();
                    
                case "guess":
                    return checkNumberGuess(command);
                    
                case "translate":
                    return handleTranslate(command);
                    
                case "bitcoin":
                    return await fetchBitcoinPrice();
                    
                case "weather":
                    return getWeather();
                    
                case "joke":
                    return getRandomJoke();
                    
                case "quote":
                    return await fetchRandomQuote();
                    
                case "dice":
                    return rollDice();
                    
                case "flip":
                    return flipCoin();
                    
                case "meme":
                    return getRandomMeme();
                    
                case "encrypt":
                    return encryptText(command);
                    
                case "sysinfo":
                    return getSystemInfo();
                    
                case "bonscik3d":
                    return getDonutArt();
                    
                case "cat":
                    return getCatArt();
                    
                case "dog":
                    return getDogArt();
                    
                case "developersling":
                    return getDeveloperInfo();
                    
                case "time":
                    return getCurrentTime();
                    
                case "music":
                    return getMusicLink();
                    
                // ===== НОВЫЕ КОМАНДЫ ===== //
                case "anime":
                    return getRandomAnime();
                    
                case "compliment":
                    return getRandomCompliment();
                    
                case "fact":
                    return await getRandomFact();
                    
                case "password":
                    return generatePassword(command);
                    
                case "color":
                    return showColor(command);
                    
                case "timer":
                    return startTimer(command);
                    
                case "qr":
                    return generateQR(command);
                    
                case "emoji":
                    return getRandomEmoji();
                    
                case "8ball":
                    return magic8Ball();
                    
                case "ascii":
                    return convertToAscii(command);
                    
                default:
                    throw new Error(`Команда "${command}" не найдена. Введите "help" для списка команд.`);
            }
        }

        // ===== ОСНОВНЫЕ ФУНКЦИИ КОМАНД ===== //
        
        function getHelpText() {
            return `Доступные команды:
[Системные]
- help - справка
- clear - очистить экран
- theme [dark/light] - сменить тему

[Утилиты]
- calc - калькулятор
- todo - список дел
- add [задача] - добавить дело
- del [номер] - удалить дело
- translate [текст] - перевод
- encrypt [текст] - шифрование
- sysinfo - информация о системе
- password [длина] - генератор паролей
- color [hex/название] - отображение цвета
- timer [время] - таймер (5s, 2m)
- qr [текст] - генератор QR-кодов
- ascii [текст] - конвертер в ASCII-коды

[Игры]
- game - угадай число
- quiz - викторина
- dice - бросить кубик
- flip - подбросить монетку
- 8ball - магический шар

[Развлечения]
- joke - случайная шутка
- quote - мудрая цитата
- meme - ASCII-мем
- bonscik3d - пончик
- cat/dog - ASCII-арты
- music - музыкальный трек
- anime - рекомендация аниме
- compliment - получить комплимент
- fact - интересный факт
- emoji - случайный эмодзи

[Данные]
- time - текущее время
- weather - прогноз погоды
- bitcoin - курс BTC
- developersling - контакты`;
        }
        
        function handleThemeCommand(command) {
            const theme = command.split(" ")[1];
            if (theme === "dark" || theme === "light") {
                state.theme = theme;
                localStorage.setItem('theme', theme);
                applyTheme();
                return `Тема изменена на ${theme}`;
            }
            throw new Error("Используйте: theme dark или theme light");
        }
        
        function handleTodoCommand() {
            return state.todoList.length 
                ? state.todoList.map((t,i) => `${i+1}. ${t}`).join('\n') 
                : "Список дел пуст!";
        }
        
        function handleAddTodo(command) {
            const task = command.substring(4).trim();
            if (!task) throw new Error("Укажите задачу");
            
            state.todoList.push(task);
            localStorage.setItem('todo', JSON.stringify(state.todoList));
            return `Добавлено: "${task}"`;
        }
        
        function handleDeleteTodo(command) {
            const index = parseInt(command.substring(4)) - 1;
            if (isNaN(index) || index < 0 || index >= state.todoList.length) {
                throw new Error("Неверный номер задачи");
            }
            
            const removed = state.todoList.splice(index, 1)[0];
            localStorage.setItem('todo', JSON.stringify(state.todoList));
            return `Удалено: "${removed}"`;
        }
        
        function startQuiz() {
            const questions = [
                {q: "Какой язык начинается с 'P' и заканчивается на 'n'?", a: "python"},
                {q: "Сколько бит в байте?", a: "8"}
            ];
            const current = questions[Math.floor(Math.random()*questions.length)];
            state.riddleAnswer = current.a;
            return `Вопрос: ${current.q}\n(Ответьте "answer ваш_ответ")`;
        }
        
        function checkQuizAnswer(command) {
            if (!state.riddleAnswer) return "Сначала запустите quiz";
            
            const answer = command.substring(7);
            state.riddleAnswer = null;
            return answer === state.riddleAnswer ? "✅ Верно!" : "❌ Неверно!";
        }
        
        function startNumberGame() {
            state.secretNumber = Math.floor(Math.random() * 10) + 1;
            return "Угадай число от 1 до 10! Напиши 'guess X'.";
        }
        
        function checkNumberGuess(command) {
            if (!state.secretNumber) return "Сначала запустите game";
            
            const guess = parseInt(command.split(" ")[1]);
            if (isNaN(guess)) throw new Error("Нужно ввести число");
            
            if (guess === state.secretNumber) {
                state.secretNumber = null;
                return "🎉 Угадал!";
            }
            return "Неверно. Попробуй ещё!";
        }
        
        function handleTranslate(command) {
            const text = command.substring(10).trim();
            if (!text) throw new Error("Укажите текст для перевода");
            return `🇬🇧 "${text}" → "Hello" (автоперевод)`;
        }
        
        async function fetchBitcoinPrice() {
            try {
                const response = await fetch('https://api.coindesk.com/v1/bpi/currentprice.json');
                const data = await response.json();
                return `₿ = $${data.bpi.USD.rate}`;
            } catch {
                throw new Error("Не удалось получить курс");
            }
        }
        
        function getWeather() {
            return `Погода в Москве:
☀️ +18°C, солнечно
💨 Ветер: 5 м/с`;
        }
        
        function getRandomJoke() {
            const jokes = [
                "Почему программист всегда мокрый? Потому что он работает с C# (си-шарп)!",
                "Какой язык программирования самый романтичный? Python, потому что он полон змей! 🐍",
                "Компьютер не грузится? Попробуйте выключить и включить его... О, вы уже 10 раз это сделали? 😅"
            ];
            return jokes[Math.floor(Math.random() * jokes.length)];
        }
        
        async function fetchRandomQuote() {
            try {
                const response = await fetch('https://api.quotable.io/random');
                const data = await response.json();
                return `"${data.content}"\n— ${data.author}`;
            } catch {
                throw new Error("Не удалось загрузить цитату");
            }
        }
        
        function rollDice() {
            return `Выпало: ${Math.floor(Math.random()*6)+1}`;
        }
        
        function flipCoin() {
            return Math.random() > 0.5 ? "Орёл!" : "Решка!";
        }
        
        function getRandomMeme() {
            const memes = [
                "░░░░░░▄▀▒▒▒▒▄▀▀▄░░\n░░░░▄▀▒▒▒▒▒▒▒▒▀▄\n░░░▄▀▒▐▒▒▒▒▒▒▒▒▒▒▀▄\n░▄▀▒▒▐▒▒▒▄▒▒▒▒▒▒▒▒▒▒▀▄\nMEME: Когда код работает с первого раза"
            ];
            return memes[Math.floor(Math.random()*memes.length)];
        }
        
        function encryptText(command) {
            const text = command.substring(8).trim();
            if (!text) throw new Error("Укажите текст для шифрования");
            return `🔐 ${btoa(text)}`;
        }
        
        function getSystemInfo() {
            return `OS: WebTerminal 3000\nUser: ${navigator.userAgent.slice(0,15)}...`;
        }
        
        function getDonutArt() {
            return `
              ,;;;,
            ;;;;;;;;
           ;;;'; ;;;    Вкусный пончик!
           ;;;   ;;;
            ';;;;;'
              ';;'`;
        }
        
        function getCatArt() {
            return `
            /\\_/\\  
           ( o.o )  
            > ^ <
        Кот требует печеньки! 🍪`;
        }
        
        function getDogArt() {
            return `
            / \\__
           (    @\\___
           /         O
          /   (_____/
         /_____/   U
        Пёсик хочет играть! 🐶`;
        }
        
        function getDeveloperInfo() {
            return `Разработчик:
Tg: @Svx1009
Сайт: cmdFreeCOM`;
        }
        
        function getCurrentTime() {
            return `Сейчас: ${new Date().toLocaleTimeString()}`;
        }
        
        function getMusicLink() {
            return "🎵 Слушай: https://youtu.be/dQw4w9WgXcQ";
        }

        // ===== НОВЫЕ ФУНКЦИИ КОМАНД ===== //
        
        function getRandomAnime() {
            const animeList = [
                "🐉 Attack on Titan",
                "🔮 Madoka Magica",
                "⚔️ Sword Art Online",
                "🏀 Kuroko no Basket",
                "👻 Tokyo Ghoul"
            ];
            return `Рекомендация: ${animeList[Math.floor(Math.random() * animeList.length]}`;
        }
        
        function getRandomCompliment() {
            const compliments = [
                "Ты выглядишь потрясающе сегодня!",
                "Твой код — произведение искусства!",
                "У тебя отличное чувство юмора!",
                "Ты просто космос! 🌌"
            ];
            return compliments[Math.floor(Math.random() * compliments.length)];
        }
        
        async function getRandomFact() {
            try {
                const response = await fetch('https://uselessfacts.jsph.pl/random.json?language=en');
                const data = await response.json();
                return `📚 Факт: ${data.text}`;
            } catch {
                return "Интересный факт: Кряканье утки не создаёт эха! (резервный факт)";
            }
        }
        
        function generatePassword(command) {
            const length = parseInt(command.split(" ")[1]) || 12;
            if (length < 4 || length > 64) return "Длина пароля должна быть от 4 до 64 символов";
            
            const charset = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789!@#$%^&*";
            let password = "";
            for (let i = 0; i < length; i++) {
                password += charset.charAt(Math.floor(Math.random() * charset.length));
            }
            return `🔑 Ваш пароль: ${password}\n(Не сохраняйте его в незащищённых местах!)`;
        }
        
        function showColor(command) {
            const color = command.split(" ")[1];
            if (!color) return "Укажите цвет (например: color ff0000 или color blue)";
            
            const colorNames = {
                red: "#ff0000", green: "#00ff00", blue: "#0000ff",
                yellow: "#ffff00", purple: "#800080", pink: "#ffc0cb"
            };
            
            const hexColor = colorNames[color] || `#${color.replace(/[^0-9a-f]/gi, '').slice(0, 6)}`;
            
            return `<div style="
                background: ${hexColor};
                width: 100px;
                height: 100px;
                margin: 10px auto;
                border: 2px solid #fff;
            "></div>Цвет: ${hexColor}`;
        }
        
        function startTimer(command) {
            const time = command.split(" ")[1];
            if (!time) return "Укажите время (например: timer 5s или timer 2m)";
            
            const unit = time.slice(-1);
            const value = parseInt(time.slice(0, -1));
            
            if (isNaN(value)) return "Некорректное время";
            
            let seconds = 0;
            switch (unit) {
                case 's': seconds = value; break;
                case 'm': seconds = value * 60; break;
                case 'h': seconds = value * 3600; break;
                default: return "Используйте s (секунды), m (минуты) или h (часы)";
            }
            
            const timerId = Date.now();
            state.timers[timerId] = setTimeout(() => {
                const output = document.getElementById("output");
                output.innerHTML += `<pre>\n⏰ Таймер на ${time} завершён!</pre>`;
                delete state.timers[timerId];
            }, seconds * 1000);
            
            return `⏳ Таймер запущен на ${time} (${seconds} секунд)`;
        }
        
        function generateQR(command) {
            const text = command.substring(3).trim();
            if (!text) return "Укажите текст для QR-кода";
            
            const encodedText = encodeURIComponent(text);
            return `QR-код для "${escapeHtml(text)}":\n` +
                   `<img class="qr-code" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodedText}" alt="QR Code">`;
        }
        
        function getRandomEmoji() {
            const emojis = ["😊", "🚀", "🎮", "🐶", "🍕", "🎵", "🌈", "👾", "🎲", "🍩"];
            return `Случайный эмодзи: ${emojis[Math.floor(Math.random() * emojis.length)]}`;
        }
        
        function magic8Ball() {
            const answers = [
                "Бесспорно", "Предрешено", "Никаких сомнений",
                "Можешь быть уверен", "Мне кажется — «да»",
                "Пока не ясно", "Спроси позже", "Лучше не рассказывать",
                "Даже не думай", "Мой ответ — «нет»"
            ];
            return `🎱 ${answers[Math.floor(Math.random() * answers.length)]}`;
        }
        
        function convertToAscii(command) {
            const text = command.substring(6).trim();
            if (!text) return "Укажите текст для преобразования";
            
            let result = "";
            for (let i = 0; i < text.length; i++) {
                result += `${text.charCodeAt(i)} `;
            }
            return `ASCII-коды: ${result.trim()}`;
        }

        // Запуск приложения
        init();
    </script>
</body>
</html>
