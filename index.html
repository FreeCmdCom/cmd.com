<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cmdFreeCOM</title>
    <style>
        :root {
            --bg-dark: #121212;
            --text-dark: #00ff00;
            --bg-light: #f0f0f0;
            --text-light: #333;
            --accent: #00aa00;
            --error: #ff5555;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: var(--bg-dark);
            color: var(--text-dark);
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }
        
        body.light-mode {
            background: var(--bg-light);
            color: var(--text-light);
        }
        
        #header {
            margin-bottom: 30px;
        }
        
        #command-input {
            width: 70%;
            padding: 12px;
            background: inherit;
            color: inherit;
            border: 2px solid var(--accent);
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        #run-button {
            padding: 12px 24px;
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: opacity 0.2s;
        }
        
        #run-button:hover {
            opacity: 0.8;
        }
        
        #output {
            margin-top: 30px;
            white-space: pre-wrap;
            font-size: 18px;
            min-height: 200px;
            border: 1px dashed var(--accent);
            padding: 20px;
            text-align: left;
            overflow-wrap: break-word;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 10px;
            color: #00ffaa;
        }
        
        .error {
            color: var(--error);
        }
        
        .qr-code {
            max-width: 150px;
            height: auto;
            display: block;
            margin: 10px auto;
        }
        
        .color-box {
            width: 100px;
            height: 100px;
            margin: 10px auto;
            border: 2px solid #fff;
        }
    </style>
</head>
<body>
    <div id="header">
        <div class="logo">cmdFreeCOM</div>
        <p>Введи команду и получи магию!</p>
    </div>

    <div>
        <input 
            type="text" 
            id="command-input" 
            placeholder="Попробуй: help, calc, anime..."
            autofocus
            aria-label="Командная строка"
        >
        <button id="run-button" onclick="runCommand()">Выполнить</button>
    </div>

    <div id="output" aria-live="polite">
        Добро пожаловать! Начни с команды "help".
    </div>

    <script>
        // Состояние приложения
        const state = {
            secretNumber: null,
            calculatorMode: false,
            riddleAnswer: null,
            todoList: JSON.parse(localStorage.getItem('todo')) || [],
            theme: localStorage.getItem('theme') || 'dark',
            gameState: null,
            timers: {}
        };

        // Инициализация
        function init() {
            loadLastCommand();
            applyTheme();
            setupEventListeners();
        }

        // Загрузка последней команды
        function loadLastCommand() {
            const lastCommand = localStorage.getItem("lastCommand");
            if (lastCommand) {
                showOutput(`Последняя команда: <strong>${escapeHtml(lastCommand)}</strong>`);
            }
        }

        // Применение темы
        function applyTheme() {
            document.body.classList.toggle('light-mode', state.theme === 'light');
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            const input = document.getElementById("command-input");
            input.addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    runCommand();
                }
            });
        }

        // Экранирование HTML
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Вывод результата
        function showOutput(content, isError = false) {
            const output = document.getElementById("output");
            output.innerHTML = `<pre${isError ? ' class="error"' : ''}>${content}</pre>`;
        }

        // Основная функция обработки команд
        async function runCommand() {
            const input = document.getElementById("command-input");
            const command = input.value.trim();
            input.value = "";
            
            if (!command) {
                showOutput("Введите команду");
                return;
            }
            
            try {
                const result = await processCommand(command);
                showOutput(result);
                
                if (command && !command.startsWith("clear")) {
                    localStorage.setItem("lastCommand", command);
                }
            } catch (error) {
                showOutput(`Ошибка: ${error.message}`, true);
            }
        }

        // Обработка команд
        async function processCommand(fullCommand) {
            const command = fullCommand.toLowerCase();
            const args = fullCommand.split(" ").slice(1).join(" ");
            
            // Режим калькулятора
            if (state.calculatorMode) {
                state.calculatorMode = false;
                try {
                    return `= ${eval(fullCommand)}`;
                } catch {
                    throw new Error("Некорректное выражение");
                }
            }
            
            // Обработка команд
            switch (command.split(" ")[0]) {
                case "calc":
                    state.calculatorMode = true;
                    return "Режим калькулятора. Введите выражение:";
                    
                case "help":
                    return `Доступные команды:
[Основные]
help - показать это сообщение
clear - очистить экран
theme [dark/light] - сменить тему

[Утилиты]
calc - калькулятор
todo - список дел
add [задача] - добавить дело
del [номер] - удалить дело
password [длина] - генератор паролей
color [hex/название] - показать цвет
timer [5s/2m/1h] - установить таймер
qr [текст] - создать QR-код
ascii [текст] - конвертировать в ASCII коды

[Развлечения]
anime - случайное аниме
compliment - получить комплимент
fact - интересный факт
joke - случайная шутка
quote - мудрая цитата
meme - случайный мем
emoji - случайный эмодзи
8ball - магический шар
bonscik3d - показать пончик
cat - показать кота
dog - показать собаку
music - музыкальный трек

[Игры]
game - угадай число
quiz - викторина
dice - бросить кубик
flip - подбросить монетку

[Информация]
time - текущее время
weather - прогноз погоды
bitcoin - курс биткоина
sysinfo - информация о системе
developersling - контакты разработчика`;
                    
                case "clear":
                    localStorage.removeItem("lastCommand");
                    return "";
                    
                case "theme":
                    return handleThemeCommand(args);
                    
                case "todo":
                    return handleTodoCommand();
                    
                case "add":
                    return handleAddTodo(args);
                    
                case "del":
                    return handleDeleteTodo(args);
                    
                case "quiz":
                    return startQuiz();
                    
                case "answer":
                    return checkQuizAnswer(args);
                    
                case "game":
                    return startNumberGame();
                    
                case "guess":
                    return checkNumberGuess(args);
                    
                case "anime":
                    return getRandomAnime();
                    
                case "compliment":
                    return getRandomCompliment();
                    
                case "fact":
                    return await getRandomFact();
                    
                case "password":
                    return generatePassword(args);
                    
                case "color":
                    return showColor(args);
                    
                case "timer":
                    return startTimer(args);
                    
                case "qr":
                    return generateQR(args);
                    
                case "emoji":
                    return getRandomEmoji();
                    
                case "8ball":
                    return magic8Ball();
                    
                case "ascii":
                    return convertToAscii(args);
                    
                case "translate":
                    return handleTranslate(args);
                    
                case "bitcoin":
                    return await fetchBitcoinPrice();
                    
                case "weather":
                    return getWeather();
                    
                case "joke":
                    return getRandomJoke();
                    
                case "quote":
                    return await fetchRandomQuote();
                    
                case "dice":
                    return rollDice();
                    
                case "flip":
                    return flipCoin();
                    
                case "meme":
                    return getRandomMeme();
                    
                case "encrypt":
                    return encryptText(args);
                    
                case "sysinfo":
                    return getSystemInfo();
                    
                case "bonscik3d":
                    return getDonutArt();
                    
                case "cat":
                    return getCatArt();
                    
                case "dog":
                    return getDogArt();
                    
                case "developersling":
                    return getDeveloperInfo();
                    
                case "time":
                    return getCurrentTime();
                    
                case "music":
                    return getMusicLink();
                    
                default:
                    throw new Error(`Команда не найдена. Введите "help" для списка команд.`);
            }
        }

        // ===== ФУНКЦИИ КОМАНД ===== //
        
        function handleThemeCommand(arg) {
            if (arg === "dark" || arg === "light") {
                state.theme = arg;
                localStorage.setItem('theme', arg);
                applyTheme();
                return `Тема изменена на ${arg}`;
            }
            throw new Error("Используйте: theme dark или theme light");
        }
        
        function handleTodoCommand() {
            return state.todoList.length 
                ? state.todoList.map((t,i) => `${i+1}. ${t}`).join('\n') 
                : "Список дел пуст!";
        }
        
        function handleAddTodo(task) {
            if (!task) throw new Error("Укажите задачу");
            state.todoList.push(task);
            localStorage.setItem('todo', JSON.stringify(state.todoList));
            return `Добавлено: "${task}"`;
        }
        
        function handleDeleteTodo(arg) {
            const index = parseInt(arg) - 1;
            if (isNaN(index) || index < 0 || index >= state.todoList.length) {
                throw new Error("Неверный номер задачи");
            }
            const removed = state.todoList.splice(index, 1)[0];
            localStorage.setItem('todo', JSON.stringify(state.todoList));
            return `Удалено: "${removed}"`;
        }
        
        function startQuiz() {
            const questions = [
                {q: "Какой язык начинается с 'P' и заканчивается на 'n'?", a: "python"},
                {q: "Сколько бит в байте?", a: "8"}
            ];
            const current = questions[Math.floor(Math.random()*questions.length)];
            state.riddleAnswer = current.a;
            return `Вопрос: ${current.q}\n(Ответьте "answer ваш_ответ")`;
        }
        
        function checkQuizAnswer(answer) {
            if (!state.riddleAnswer) return "Сначала запустите quiz";
            const isCorrect = answer === state.riddleAnswer;
            state.riddleAnswer = null;
            return isCorrect ? "✅ Верно!" : "❌ Неверно!";
        }
        
        function startNumberGame() {
            state.secretNumber = Math.floor(Math.random() * 10) + 1;
            return "Угадай число от 1 до 10! Напиши 'guess X'.";
        }
        
        function checkNumberGuess(guess) {
            if (!state.secretNumber) return "Сначала запустите game";
            const num = parseInt(guess);
            if (isNaN(num)) throw new Error("Нужно ввести число");
            if (num === state.secretNumber) {
                state.secretNumber = null;
                return "🎉 Угадал!";
            }
            return "Неверно. Попробуй ещё!";
        }
        
        function getRandomAnime() {
            const animeList = [
                "🐉 Attack on Titan",
                "🔮 Madoka Magica",
                "⚔️ Sword Art Online",
                "🏀 Kuroko no Basket",
                "👻 Tokyo Ghoul"
            ];
            return `Рекомендация: ${animeList[Math.floor(Math.random() * animeList.length)]}`;
        }
        
        function getRandomCompliment() {
            const compliments = [
                "Ты выглядишь потрясающе сегодня!",
                "Твой код — произведение искусства!",
                "У тебя отличное чувство юмора!",
                "Ты просто космос! 🌌"
            ];
            return compliments[Math.floor(Math.random() * compliments.length)];
        }
        
        async function getRandomFact() {
            try {
                const response = await fetch('https://uselessfacts.jsph.pl/random.json?language=en');
                const data = await response.json();
                return `📚 Факт: ${data.text}`;
            } catch {
                return "Интересный факт: Кряканье утки не создаёт эха!";
            }
        }
        
        function generatePassword(lengthArg) {
            const length = parseInt(lengthArg) || 12;
            if (length < 4 || length > 64) return "Длина пароля должна быть от 4 до 64 символов";
            
            const charset = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789!@#$%^&*";
            let password = "";
            for (let i = 0; i < length; i++) {
                password += charset.charAt(Math.floor(Math.random() * charset.length));
            }
            return `🔑 Ваш пароль: ${password}\n(Не сохраняйте его в незащищённых местах!)`;
        }
        
        function showColor(color) {
            if (!color) return "Укажите цвет (например: color ff0000 или color blue)";
            
            const colorNames = {
                red: "#ff0000", green: "#00ff00", blue: "#0000ff",
                yellow: "#ffff00", purple: "#800080", pink: "#ffc0cb"
            };
            
            const hexColor = colorNames[color.toLowerCase()] || 
                            (color.startsWith("#") ? color : `#${color.replace(/[^0-9a-f]/gi, '').slice(0, 6)}`);
            
            return `<div class="color-box" style="background: ${hexColor}"></div>Цвет: ${hexColor}`;
        }
        
        function startTimer(time) {
            if (!time) return "Укажите время (например: timer 5s или timer 2m)";
            
            const unit = time.slice(-1);
            const value = parseInt(time.slice(0, -1));
            
            if (isNaN(value)) return "Некорректное время";
            
            let seconds = 0;
            switch (unit) {
                case 's': seconds = value; break;
                case 'm': seconds = value * 60; break;
                case 'h': seconds = value * 3600; break;
                default: return "Используйте s (секунды), m (минуты) или h (часы)";
            }
            
            const timerId = Date.now();
            state.timers[timerId] = setTimeout(() => {
                const output = document.getElementById("output");
                output.innerHTML += `<pre>⏰ Таймер на ${time} завершён!</pre>`;
                delete state.timers[timerId];
            }, seconds * 1000);
            
            return `⏳ Таймер запущен на ${time} (${seconds} секунд)`;
        }
        
        function generateQR(text) {
            if (!text) return "Укажите текст для QR-кода";
            const encodedText = encodeURIComponent(text);
            return `QR-код для "${escapeHtml(text)}":\n` +
                   `<img class="qr-code" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodedText}" alt="QR Code">`;
        }
        
        function getRandomEmoji() {
            const emojis = ["😊", "🚀", "🎮", "🐶", "🍕", "🎵", "🌈", "👾", "🎲", "🍩"];
            return `Случайный эмодзи: ${emojis[Math.floor(Math.random() * emojis.length)]}`;
        }
        
        function magic8Ball() {
            const answers = [
                "Бесспорно", "Предрешено", "Никаких сомнений",
                "Можешь быть уверен", "Мне кажется — «да»",
                "Пока не ясно", "Спроси позже", "Лучше не рассказывать",
                "Даже не думай", "Мой ответ — «нет»"
            ];
            return `🎱 ${answers[Math.floor(Math.random() * answers.length)]}`;
        }
        
        function convertToAscii(text) {
            if (!text) return "Укажите текст для преобразования";
            let result = "";
            for (let i = 0; i < text.length; i++) {
                result += `${text.charCodeAt(i)} `;
            }
            return `ASCII-коды: ${result.trim()}`;
        }
        
        function handleTranslate(text) {
            if (!text) throw new Error("Укажите текст для перевода");
            return `🇬🇧 "${text}" → "Hello" (автоперевод)`;
        }
        
        async function fetchBitcoinPrice() {
            try {
                const response = await fetch('https://api.coindesk.com/v1/bpi/currentprice.json');
                const data = await response.json();
                return `₿ = $${data.bpi.USD.rate}`;
            } catch {
                throw new Error("Не удалось получить курс");
            }
        }
        
        function getWeather() {
            return `Погода в Москве:
☀️ +18°C, солнечно
💨 Ветер: 5 м/с`;
        }
        
        function getRandomJoke() {
            const jokes = [
                "Почему программист всегда мокрый? Потому что он работает с C# (си-шарп)!",
                "Какой язык программирования самый романтичный? Python, потому что он полон змей! 🐍",
                "Компьютер не грузится? Попробуйте выключить и включить его... О, вы уже 10 раз это сделали? 😅"
            ];
            return jokes[Math.floor(Math.random() * jokes.length)];
        }
        
        async function fetchRandomQuote() {
            try {
                const response = await fetch('https://api.quotable.io/random');
                const data = await response.json();
                return `"${data.content}"\n— ${data.author}`;
            } catch {
                throw new Error("Не удалось загрузить цитату");
            }
        }
        
        function rollDice() {
            return `Выпало: ${Math.floor(Math.random()*6)+1}`;
        }
        
        function flipCoin() {
            return Math.random() > 0.5 ? "Орёл!" : "Решка!";
        }
        
        function getRandomMeme() {
            const memes = [
                "░░░░░░▄▀▒▒▒▒▄▀▀▄░░\n░░░░▄▀▒▒▒▒▒▒▒▒▀▄\n░░░▄▀▒▐▒▒▒▒▒▒▒▒▒▒▀▄\n░▄▀▒▒▐▒▒▒▄▒▒▒▒▒▒▒▒▒▒▀▄\nMEME: Когда код работает с первого раза"
            ];
            return memes[Math.floor(Math.random()*memes.length)];
        }
        
        function encryptText(text) {
            if (!text) throw new Error("Укажите текст для шифрования");
            return `🔐 ${btoa(text)}`;
        }
        
        function getSystemInfo() {
            return `OS: WebTerminal 3000\nUser: ${navigator.userAgent.slice(0,15)}...`;
        }
        
        function getDonutArt() {
            return `
              ,;;;,
            ;;;;;;;;
           ;;;'; ;;;    Вкусный пончик!
           ;;;   ;;;
            ';;;;;'
              ';;'`;
        }
        
        function getCatArt() {
            return `
            /\\_/\\  
           ( o.o )  
            > ^ <
        Кот требует печеньки! 🍪`;
        }
        
        function getDogArt() {
            return `
            / \\__
           (    @\\___
           /         O
          /   (_____/
         /_____/   U
        Пёсик хочет играть! 🐶`;
        }
        
        function getDeveloperInfo() {
            return `Разработчик:
Tg: @Svx1009
Сайт: cmdFreeCOM`;
        }
        
        function getCurrentTime() {
            return `Сейчас: ${new Date().toLocaleTimeString()}`;
        }
        
        function getMusicLink() {
            return "🎵 Слушай: https://youtu.be/dQw4w9WgXcQ";
        }

        // Запуск приложения
        init();
    </script>
</body>
</html>
