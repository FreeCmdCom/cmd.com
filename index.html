<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cmdFreeCOM 2.0</title>
    <style>
        :root {
            --bg-dark: #121212;
            --text-dark: #00ff00;
            --bg-light: #f0f0f0;
            --text-light: #333;
            --accent: #00aa00;
            --error: #ff5555;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: var(--bg-dark);
            color: var(--text-dark);
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }
        
        body.light-mode {
            background: var(--bg-light);
            color: var(--text-light);
        }
        
        #header {
            margin-bottom: 30px;
        }
        
        #command-input {
            width: 70%;
            padding: 12px;
            background: inherit;
            color: inherit;
            border: 2px solid var(--accent);
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        #run-button {
            padding: 12px 24px;
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: opacity 0.2s;
        }
        
        #run-button:hover {
            opacity: 0.8;
        }
        
        #output {
            margin-top: 30px;
            white-space: pre-wrap;
            font-size: 18px;
            min-height: 200px;
            border: 1px dashed var(--accent);
            padding: 20px;
            text-align: left;
            overflow-wrap: break-word;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 10px;
            color: #00ffaa;
        }
        
        .error {
            color: var(--error);
        }
        
        .qr-code {
            max-width: 150px;
            height: auto;
            display: block;
            margin: 10px auto;
        }
        
        .color-box {
            width: 100px;
            height: 100px;
            margin: 10px auto;
            border: 2px solid #fff;
        }
        
        .progress-bar {
            height: 20px;
            background: #333;
            margin: 10px 0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.5s;
        }
    </style>
</head>
<body>
    <div id="header">
        <div class="logo">cmdFreeCOM 2.0</div>
        <p>Введите команду (100+ функций!)</p>
    </div>

    <div>
        <input 
            type="text" 
            id="command-input" 
            placeholder="Начните с help..."
            autofocus
            aria-label="Командная строка"
        >
        <button id="run-button" onclick="runCommand()">Выполнить</button>
    </div>

    <div id="output" aria-live="polite">
        Добро пожаловать! Введите <strong>help</strong> для списка команд.
    </div>

    <script>
        // ===== КОНФИГУРАЦИЯ ===== //
        const VERSION = "2.0";
        const MAX_HISTORY = 50;
        
        // Состояние приложения
        const state = {
            secretNumber: null,
            calculatorMode: false,
            riddleAnswer: null,
            todoList: JSON.parse(localStorage.getItem('todo')) || [],
            theme: localStorage.getItem('theme') || 'dark',
            gameState: null,
            timers: {},
            commandHistory: JSON.parse(localStorage.getItem('cmdHistory')) || [],
            currentDir: "~",
            files: {
                "~": ["readme.txt", "projects/", "secret/"],
                "~/projects": ["cmdFreeCOM/", "game.js"],
                "~/secret": ["password.txt"]
            }
        };

        // ===== ОСНОВНЫЕ ФУНКЦИИ ===== //
        function init() {
            loadHistory();
            applyTheme();
            setupEventListeners();
            checkFirstRun();
        }

        function checkFirstRun() {
            if (!localStorage.getItem('firstRun')) {
                showOutput(`cmdFreeCOM ${VERSION} запущен! Введите <strong>help</strong> для начала.`);
                localStorage.setItem('firstRun', 'true');
            }
        }

        function loadHistory() {
            if (state.commandHistory.length > 0) {
                showOutput(`Последняя команда: <strong>${escapeHtml(state.commandHistory[0])}</strong>`);
            }
        }

        function applyTheme() {
            document.body.classList.toggle('light-mode', state.theme === 'light');
        }

        function setupEventListeners() {
            const input = document.getElementById("command-input");
            input.addEventListener("keypress", function(event) {
                if (event.key === "Enter") runCommand();
            });
            
            // Автодополнение при нажатии Tab
            input.addEventListener("keydown", function(event) {
                if (event.key === "Tab") {
                    event.preventDefault();
                    suggestCommand(input.value.trim());
                }
            });
        }

        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function showOutput(content, isError = false) {
            const output = document.getElementById("output");
            output.innerHTML = `<pre${isError ? ' class="error"' : ''}>${content}</pre>`;
        }

        function addToHistory(command) {
            state.commandHistory.unshift(command);
            if (state.commandHistory.length > MAX_HISTORY) {
                state.commandHistory.pop();
            }
            localStorage.setItem('cmdHistory', JSON.stringify(state.commandHistory));
        }

        function suggestCommand(partialCmd) {
            const commands = getAllCommands();
            const matches = commands.filter(cmd => cmd.startsWith(partialCmd));
            
            if (matches.length === 1) {
                document.getElementById("command-input").value = matches[0];
            } else if (matches.length > 1) {
                showOutput(`Возможные команды: ${matches.join(", ")}`);
            }
        }

        function getAllCommands() {
            return [
                "help", "clear", "theme", "calc", "todo", "add", "del", 
                "quiz", "answer", "game", "guess", "anime", "compliment",
                "fact", "password", "color", "timer", "qr", "emoji", "8ball",
                "ascii", "translate", "bitcoin", "weather", "joke", "quote",
                "dice", "flip", "meme", "encrypt", "sysinfo", "bonscik3d",
                "cat", "dog", "developersling", "time", "music", "ls", "cd",
                "mkdir", "touch", "rm", "ping", "whoami", "uptime", "date",
                "calendar", "ip", "browser", "screen", "geo", "battery",
                "network", "font", "matrix", "starwars", "tetris", "snake",
                "pong", "tictactoe", "hangman", "rps", "lottery", "coinflip",
                "roulette", "dart", "sudoku", "chess", "maze", "adventure",
                "zork", "trivia", "math", "physics", "chemistry", "biology",
                "history", "art", "poem", "song", "lyrics", "recipe", "cocktail",
                "train", "flight", "crypto", "stock", "news", "movie", "tvshow",
                "book", "author", "paint", "draw", "photo", "moon", "sun", "mars",
                "stars", "universe", "love", "friendship", "wisdom", "secret"
            ];
        }

        // ===== ОБРАБОТКА КОМАНД ===== //
        async function runCommand() {
            const input = document.getElementById("command-input");
            const command = input.value.trim();
            input.value = "";
            
            if (!command) {
                showOutput("Введите команду");
                return;
            }
            
            try {
                const result = await processCommand(command);
                showOutput(result);
                addToHistory(command);
            } catch (error) {
                showOutput(`Ошибка: ${error.message}`, true);
            }
        }

        async function processCommand(fullCommand) {
            const command = fullCommand.toLowerCase();
            const args = fullCommand.split(" ").slice(1).join(" ");
            
            if (state.calculatorMode) {
                state.calculatorMode = false;
                try {
                    return `= ${eval(fullCommand)}`;
                } catch {
                    throw new Error("Некорректное выражение");
                }
            }
            
            // Категории команд
            const commandCategories = {
                // Системные
                system: ["help", "clear", "theme", "sysinfo", "whoami", "uptime"],
                
                // Файловая система
                fs: ["ls", "cd", "mkdir", "touch", "rm"],
                
                // Утилиты
                utils: ["calc", "todo", "add", "del", "password", "color", "timer", 
                       "qr", "ascii", "encrypt", "ping", "date", "calendar"],
                
                // Развлечения
                fun: ["anime", "compliment", "joke", "quote", "meme", "emoji", 
                     "fact", "poem", "song", "lyrics", "recipe", "cocktail"],
                
                // Игры
                games: ["game", "guess", "quiz", "answer", "dice", "flip", "8ball",
                       "rps", "lottery", "roulette", "tictactoe", "hangman", "snake"],
                
                // Интернет
                web: ["translate", "bitcoin", "weather", "crypto", "stock", "news",
                     "movie", "tvshow", "book", "geo", "ip", "browser"],
                
                // Мультимедиа
                media: ["music", "art", "paint", "draw", "photo", "starwars"],
                
                // Наука
                science: ["math", "physics", "chemistry", "biology", "history"],
                
                // Космос
                space: ["moon", "sun", "mars", "stars", "universe"],
                
                // Другое
                other: ["bonscik3d", "cat", "dog", "developersling", "love", 
                       "friendship", "wisdom", "secret", "matrix"]
            };

            // Обработка команд
            switch (command.split(" ")[0]) {
                // ===== СИСТЕМНЫЕ ===== //
                case "help":
                    return showHelp();
                    
                case "clear":
                    return "";
                    
                case "theme":
                    return setTheme(args);
                    
                case "sysinfo":
                    return getSystemInfo();
                    
                case "whoami":
                    return `Вы: ${navigator.userAgent.split(' ')[0]}...`;
                    
                case "uptime":
                    return `Система работает: ${Math.floor(performance.now() / 1000)} сек`;
                
                // ===== ФАЙЛОВАЯ СИСТЕМА ===== //
                case "ls":
                    return listFiles();
                    
                case "cd":
                    return changeDir(args);
                    
                case "mkdir":
                    return makeDir(args);
                    
                case "touch":
                    return createFile(args);
                    
                case "rm":
                    return removeFile(args);
                
                // ===== УТИЛИТЫ ===== //
                case "calc":
                    state.calculatorMode = true;
                    return "Режим калькулятора. Введите выражение:";
                    
                case "todo":
                    return showTodoList();
                    
                case "add":
                    return addTodoItem(args);
                    
                case "del":
                    return removeTodoItem(args);
                    
                case "password":
                    return generatePassword(args);
                    
                case "color":
                    return showColor(args);
                    
                case "timer":
                    return startTimer(args);
                    
                case "qr":
                    return generateQR(args);
                    
                case "ascii":
                    return textToAscii(args);
                    
                case "encrypt":
                    return encryptText(args);
                    
                case "ping":
                    return `Pong! Задержка: ${Math.floor(Math.random() * 100)}ms`;
                    
                case "date":
                    return new Date().toLocaleDateString();
                    
                case "calendar":
                    return showCalendar();
                
                // ===== РАЗВЛЕЧЕНИЯ ===== //
                case "anime":
                    return getRandomAnime();
                    
                case "compliment":
                    return getRandomCompliment();
                    
                case "joke":
                    return getRandomJoke();
                    
                case "quote":
                    return getRandomQuote();
                    
                case "meme":
                    return getRandomMeme();
                    
                case "emoji":
                    return getRandomEmoji();
                    
                case "fact":
                    return getRandomFact();
                    
                case "poem":
                    return getRandomPoem();
                    
                case "song":
                    return getRandomSong();
                    
                case "lyrics":
                    return getRandomLyrics();
                    
                case "recipe":
                    return getRandomRecipe();
                    
                case "cocktail":
                    return getRandomCocktail();
                
                // ===== ИГРЫ ===== //
                case "game":
                    return startNumberGame();
                    
                case "guess":
                    return checkNumberGuess(args);
                    
                case "quiz":
                    return startQuiz();
                    
                case "answer":
                    return checkQuizAnswer(args);
                    
                case "dice":
                    return rollDice();
                    
                case "flip":
                    return flipCoin();
                    
                case "8ball":
                    return magic8Ball();
                    
                case "rps":
                    return playRockPaperScissors(args);
                    
                case "lottery":
                    return generateLotteryNumbers();
                    
                case "roulette":
                    return playRoulette();
                    
                case "tictactoe":
                    return startTicTacToe();
                    
                case "hangman":
                    return startHangman();
                    
                case "snake":
                    return "🐍 Запуск Snake... (в разработке)";
                
                // ===== ИНТЕРНЕТ ===== //
                case "translate":
                    return translateText(args);
                    
                case "bitcoin":
                    return getBitcoinPrice();
                    
                case "weather":
                    return getWeather();
                    
                case "crypto":
                    return getCryptoPrices();
                    
                case "stock":
                    return getStockInfo();
                    
                case "news":
                    return getLatestNews();
                    
                case "movie":
                    return getRandomMovie();
                    
                case "tvshow":
                    return getRandomTVShow();
                    
                case "book":
                    return getRandomBook();
                    
                case "geo":
                    return getGeoInfo();
                    
                case "ip":
                    return getUserIP();
                    
                case "browser":
                    return getBrowserInfo();
                
                // ===== МУЛЬТИМЕДИА ===== //
                case "music":
                    return getMusicLink();
                    
                case "art":
                    return getRandomArt();
                    
                case "paint":
                    return "🎨 Виртуальный холст (в разработке)";
                    
                case "draw":
                    return getRandomDrawing();
                    
                case "photo":
                    return getRandomPhoto();
                    
                case "starwars":
                    return getStarWarsQuote();
                
                // ===== НАУКА ===== //
                case "math":
                    return getMathFact();
                    
                case "physics":
                    return getPhysicsFact();
                    
                case "chemistry":
                    return getChemistryFact();
                    
                case "biology":
                    return getBiologyFact();
                    
                case "history":
                    return getHistoryFact();
                
                // ===== КОСМОС ===== //
                case "moon":
                    return getMoonPhase();
                    
                case "sun":
                    return getSunInfo();
                    
                case "mars":
                    return getMarsFact();
                    
                case "stars":
                    return getStarInfo();
                    
                case "universe":
                    return getUniverseFact();
                
                // ===== ДРУГОЕ ===== //
                case "bonscik3d":
                    return getDonutArt();
                    
                case "cat":
                    return getCatArt();
                    
                case "dog":
                    return getDogArt();
                    
                case "developersling":
                    return getDeveloperInfo();
                    
                case "time":
                    return getCurrentTime();
                    
                case "love":
                    return getLoveQuote();
                    
                case "friendship":
                    return getFriendshipQuote();
                    
                case "wisdom":
                    return getWisdomQuote();
                    
                case "secret":
                    return revealSecret();
                    
                case "matrix":
                    return "Подключение к Матрице...";
                    
                default:
                    throw new Error(`Команда не найдена. Введите "help" для списка.`);
            }
        }

        // ===== РЕАЛИЗАЦИЯ КОМАНД ===== //

        function showHelp() {
            return `cmdFreeCOM ${VERSION} - 100+ команд

[СИСТЕМА]
help       - справка
clear      - очистить экран
theme      - сменить тему (dark/light)
sysinfo    - информация о системе
whoami     - информация о пользователе
uptime     - время работы системы

[ФАЙЛЫ]
ls         - список файлов
cd         - сменить директорию
mkdir      - создать папку
touch      - создать файл
rm         - удалить файл

[УТИЛИТЫ]
calc       - калькулятор
todo       - список дел
add/del    - управление делами
password   - генератор паролей
color      - отображение цвета
timer      - таймер (5s, 10m)
qr         - генератор QR-кодов
ascii      - конвертер в ASCII
encrypt    - шифрование текста
ping       - проверить соединение
date       - текущая дата
calendar   - календарь

[РАЗВЛЕЧЕНИЯ]
anime      - рекомендация аниме
compliment - получить комплимент
joke       - случайная шутка
quote      - мудрая цитата
meme       - случайный мем
emoji      - случайный эмодзи
fact       - интересный факт
poem       - случайное стихотворение
song       - рекомендация песни
lyrics     - текст песни
recipe     - случайный рецепт
cocktail   - рецепт коктейля

[ИГРЫ]
game       - угадай число
quiz       - викторина
dice       - бросить кубик
flip       - подбросить монетку
8ball      - магический шар
rps        - камень-ножницы-бумага
lottery    - лотерейные номера
roulette   - рулетка
tictactoe  - крестики-нолики
hangman    - виселица
snake      - змейка

[ИНТЕРНЕТ]
translate  - переводчик
bitcoin    - курс BTC
weather    - прогноз погоды
crypto     - курсы криптовалют
stock      - акции
news       - последние новости
movie      - случайный фильм
tvshow     - случайный сериал
book       - рекомендация книги
geo        - геолокация
ip         - ваш IP-адрес
browser    - информация о браузере

[МУЛЬТИМЕДИА]
music      - музыкальный трек
art        - случайное искусство
paint      - рисование
draw       - случайный рисунок
photo      - случайное фото
starwars   - цитата из Звёздных Войн

[НАУКА]
math       - математический факт
physics    - факт о физике
chemistry  - факт о химии
biology    - факт о биологии
history    - исторический факт

[КОСМОС]
moon       - фаза луны
sun        - информация о солнце
mars       - факты о Марсе
stars      - информация о звездах
universe   - факт о вселенной

[ДРУГОЕ]
bonscik3d  - ASCII-пончик
cat/dog    - ASCII-животные
time       - текущее время
love       - цитата о любви
friendship - цитата о дружбе
wisdom     - мудрая мысль
secret     - секретная команда
matrix     - войти в матрицу

Введите <strong>help [категория]</strong> для деталей`;
        }

        // ... (реализация всех команд) ...

        // Запуск приложения
        init();
    </script>
</body>
</html>
