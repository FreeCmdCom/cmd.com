<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cmdFreeCOM</title>
    <style>
        :root {
            --bg-dark: #121212;
            --text-dark: #00ff00;
            --bg-light: #f0f0f0;
            --text-light: #333;
            --accent: #00aa00;
            --error: #ff5555;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: var(--bg-dark);
            color: var(--text-dark);
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }
        
        body.light-mode {
            background: var(--bg-light);
            color: var(--text-light);
        }
        
        #header {
            margin-bottom: 30px;
        }
        
        #command-input {
            width: 70%;
            padding: 12px;
            background: inherit;
            color: inherit;
            border: 2px solid var(--accent);
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        #run-button {
            padding: 12px 24px;
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: opacity 0.2s;
        }
        
        #run-button:hover {
            opacity: 0.8;
        }
        
        #output {
            margin-top: 30px;
            white-space: pre-wrap;
            font-size: 18px;
            min-height: 200px;
            border: 1px dashed var(--accent);
            padding: 20px;
            text-align: left;
            overflow-wrap: break-word;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 10px;
            color: #00ffaa;
        }
        
        .error {
            color: var(--error);
        }
    </style>
</head>
<body>
    <div id="header">
        <div class="logo">cmdFreeCOM</div>
        <p>Введи команду и получи магию!</p>
    </div>

    <div>
        <input 
            type="text" 
            id="command-input" 
            placeholder="Попробуй: help, calc, bitcoin..."
            autofocus
            aria-label="Командная строка"
        >
        <button id="run-button" onclick="runCommand()">Выполнить</button>
    </div>

    <div id="output" aria-live="polite">
        Добро пожаловать! Начни с команды "help".
    </div>

    <script>
        // Состояние приложения
        const state = {
            secretNumber: null,
            calculatorMode: false,
            riddleAnswer: null,
            todoList: JSON.parse(localStorage.getItem('todo')) || [],
            theme: localStorage.getItem('theme') || 'dark',
            gameState: null
        };

        // Инициализация
        function init() {
            loadLastCommand();
            applyTheme();
            setupEventListeners();
        }

        // Загрузка последней команды
        function loadLastCommand() {
            const lastCommand = localStorage.getItem("lastCommand");
            if (lastCommand) {
                document.getElementById("output").innerHTML = 
                    `<pre>Последняя команда: <strong>${escapeHtml(lastCommand)}</strong></pre>`;
            }
        }

        // Применение темы
        function applyTheme() {
            document.body.classList.toggle('light-mode', state.theme === 'light');
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            const input = document.getElementById("command-input");
            input.addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    runCommand();
                }
            });
        }

        // Экранирование HTML
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Основная функция обработки команд
        async function runCommand() {
            const input = document.getElementById("command-input");
            const command = input.value.trim();
            const output = document.getElementById("output");

            // Очистка ввода
            input.value = "";
            
            try {
                const result = await processCommand(command.toLowerCase());
                output.innerHTML = `<pre>${result}</pre>`;
                
                // Сохраняем команду (кроме clear)
                if (command && !command.startsWith("clear")) {
                    localStorage.setItem("lastCommand", command);
                }
            } catch (error) {
                output.innerHTML = `<pre class="error">Ошибка: ${error.message}</pre>`;
            }
        }

        // Обработка команд
        async function processCommand(command) {
            if (!command) return "Введите команду";
            
            // Режим калькулятора
            if (state.calculatorMode) {
                state.calculatorMode = false;
                try {
                    return `= ${eval(command)}`;
                } catch {
                    throw new Error("Некорректное выражение");
                }
            }
            
            // Обработка команд
            switch (command.split(" ")[0]) {
                case "calc":
                    state.calculatorMode = true;
                    return "Режим калькулятора. Введите выражение:";
                    
                case "help":
                    return getHelpText();
                    
                case "clear":
                    localStorage.removeItem("lastCommand");
                    return "";
                    
                case "theme":
                    return handleThemeCommand(command);
                    
                case "todo":
                    return handleTodoCommand();
                    
                case "add":
                    return handleAddTodo(command);
                    
                case "del":
                    return handleDeleteTodo(command);
                    
                case "quiz":
                    return startQuiz();
                    
                case "answer":
                    return checkQuizAnswer(command);
                    
                case "game":
                    return startNumberGame();
                    
                case "guess":
                    return checkNumberGuess(command);
                    
                case "translate":
                    return handleTranslate(command);
                    
                case "bitcoin":
                    return await fetchBitcoinPrice();
                    
                case "weather":
                    return getWeather();
                    
                case "joke":
                    return getRandomJoke();
                    
                case "quote":
                    return await fetchRandomQuote();
                    
                case "dice":
                    return rollDice();
                    
                case "flip":
                    return flipCoin();
                    
                case "meme":
                    return getRandomMeme();
                    
                case "encrypt":
                    return encryptText(command);
                    
                case "sysinfo":
                    return getSystemInfo();
                    
                case "bonscik3d":
                    return getDonutArt();
                    
                case "cat":
                    return getCatArt();
                    
                case "dog":
                    return getDogArt();
                    
                case "developersling":
                    return getDeveloperInfo();
                    
                case "time":
                    return getCurrentTime();
                    
                case "music":
                    return getMusicLink();
                    
                default:
                    throw new Error(`Команда "${command}" не найдена. Введите "help" для списка команд.`);
            }
        }

        // ===== ФУНКЦИИ КОМАНД ===== //
        
        function getHelpText() {
            return `Доступные команды:
[Системные]
- help - справка
- clear - очистить экран
- theme [dark/light] - сменить тему

[Утилиты]
- calc - калькулятор
- todo - список дел
- add [задача] - добавить дело
- del [номер] - удалить дело
- translate [текст] - перевод
- encrypt [текст] - шифрование
- sysinfo - информация о системе

[Игры]
- game - угадай число
- quiz - викторина
- dice - бросить кубик
- flip - подбросить монетку

[Развлечения]
- joke - случайная шутка
- quote - мудрая цитата
- meme - ASCII-мем
- bonscik3d - пончик
- cat/dog - ASCII-арты
- music - музыкальный трек

[Данные]
- time - текущее время
- weather - прогноз погоды
- bitcoin - курс BTC
- developersling - контакты`;
        }
        
        function handleThemeCommand(command) {
            const theme = command.split(" ")[1];
            if (theme === "dark" || theme === "light") {
                state.theme = theme;
                localStorage.setItem('theme', theme);
                applyTheme();
                return `Тема изменена на ${theme}`;
            }
            throw new Error("Используйте: theme dark или theme light");
        }
        
        function handleTodoCommand() {
            return state.todoList.length 
                ? state.todoList.map((t,i) => `${i+1}. ${t}`).join('\n') 
                : "Список дел пуст!";
        }
        
        function handleAddTodo(command) {
            const task = command.substring(4).trim();
            if (!task) throw new Error("Укажите задачу");
            
            state.todoList.push(task);
            localStorage.setItem('todo', JSON.stringify(state.todoList));
            return `Добавлено: "${task}"`;
        }
        
        function handleDeleteTodo(command) {
            const index = parseInt(command.substring(4)) - 1;
            if (isNaN(index) || index < 0 || index >= state.todoList.length) {
                throw new Error("Неверный номер задачи");
            }
            
            const removed = state.todoList.splice(index, 1)[0];
            localStorage.setItem('todo', JSON.stringify(state.todoList));
            return `Удалено: "${removed}"`;
        }
        
        function startQuiz() {
            const questions = [
                {q: "Какой язык начинается с 'P' и заканчивается на 'n'?", a: "python"},
                {q: "Сколько бит в байте?", a: "8"}
            ];
            const current = questions[Math.floor(Math.random()*questions.length)];
            state.riddleAnswer = current.a;
            return `Вопрос: ${current.q}\n(Ответьте "answer ваш_ответ")`;
        }
        
        function checkQuizAnswer(command) {
            if (!state.riddleAnswer) return "Сначала запустите quiz";
            
            const answer = command.substring(7);
            state.riddleAnswer = null;
            return answer === state.riddleAnswer ? "✅ Верно!" : "❌ Неверно!";
        }
        
        function startNumberGame() {
            state.secretNumber = Math.floor(Math.random() * 10) + 1;
            return "Угадай число от 1 до 10! Напиши 'guess X'.";
        }
        
        function checkNumberGuess(command) {
            if (!state.secretNumber) return "Сначала запустите game";
            
            const guess = parseInt(command.split(" ")[1]);
            if (isNaN(guess)) throw new Error("Нужно ввести число");
            
            if (guess === state.secretNumber) {
                state.secretNumber = null;
                return "🎉 Угадал!";
            }
            return "Неверно. Попробуй ещё!";
        }
        
        function handleTranslate(command) {
            const text = command.substring(10).trim();
            if (!text) throw new Error("Укажите текст для перевода");
            return `🇬🇧 "${text}" → "Hello" (автоперевод)`;
        }
        
        async function fetchBitcoinPrice() {
            try {
                const response = await fetch('https://api.coindesk.com/v1/bpi/currentprice.json');
                const data = await response.json();
                return `₿ = $${data.bpi.USD.rate}`;
            } catch {
                throw new Error("Не удалось получить курс");
            }
        }
        
        function getWeather() {
            return `Погода в Москве:
☀️ +18°C, солнечно
💨 Ветер: 5 м/с`;
        }
        
        function getRandomJoke() {
            const jokes = [
                "Почему программист всегда мокрый? Потому что он работает с C# (си-шарп)!",
                "Какой язык программирования самый романтичный? Python, потому что он полон змей! 🐍",
                "Компьютер не грузится? Попробуйте выключить и включить его... О, вы уже 10 раз это сделали? 😅"
            ];
            return jokes[Math.floor(Math.random() * jokes.length)];
        }
        
        async function fetchRandomQuote() {
            try {
                const response = await fetch('https://api.quotable.io/random');
                const data = await response.json();
                return `"${data.content}"\n— ${data.author}`;
            } catch {
                throw new Error("Не удалось загрузить цитату");
            }
        }
        
        function rollDice() {
            return `Выпало: ${Math.floor(Math.random()*6)+1}`;
        }
        
        function flipCoin() {
            return Math.random() > 0.5 ? "Орёл!" : "Решка!";
        }
        
        function getRandomMeme() {
            const memes = [
                "░░░░░░▄▀▒▒▒▒▄▀▀▄░░\n░░░░▄▀▒▒▒▒▒▒▒▒▀▄\n░░░▄▀▒▐▒▒▒▒▒▒▒▒▒▒▀▄\n░▄▀▒▒▐▒▒▒▄▒▒▒▒▒▒▒▒▒▒▀▄\nMEME: Когда код работает с первого раза"
            ];
            return memes[Math.floor(Math.random()*memes.length)];
        }
        
        function encryptText(command) {
            const text = command.substring(8).trim();
            if (!text) throw new Error("Укажите текст для шифрования");
            return `🔐 ${btoa(text)}`;
        }
        
        function getSystemInfo() {
            return `OS: WebTerminal 3000\nUser: ${navigator.userAgent.slice(0,15)}...`;
        }
        
        function getDonutArt() {
            return `
              ,;;;,
            ;;;;;;;;
           ;;;'; ;;;    Вкусный пончик!
           ;;;   ;;;
            ';;;;;'
              ';;'`;
        }
        
        function getCatArt() {
            return `
            /\\_/\\  
           ( o.o )  
            > ^ <
        Кот требует печеньки! 🍪`;
        }
        
        function getDogArt() {
            return `
            / \\__
           (    @\\___
           /         O
          /   (_____/
         /_____/   U
        Пёсик хочет играть! 🐶`;
        }
        
        function getDeveloperInfo() {
            return `Разработчик:
Tg: @Svx1009
Сайт: cmdFreeCOM`;
        }
        
        function getCurrentTime() {
            return `Сейчас: ${new Date().toLocaleTimeString()}`;
        }
        
        function getMusicLink() {
            return "🎵 Слушай: https://youtu.be/dQw4w9WgXcQ";
        }

        // Запуск приложения
        init();
    </script>
</body>
</html>
